# =============================================================================
# Caddyfile.template â€” Reverse proxy for code-server (VS Code web)
#
# Usage:
#   With domain:    replace {DOMAIN} with your domain name
#   Without domain: use the :8080 block below
#
# Copy to /etc/caddy/Caddyfile and reload: sudo systemctl reload caddy
# =============================================================================

# === OPTION 1: With a domain (Let's Encrypt auto-TLS) ===
# Uncomment and replace {DOMAIN} with your actual domain.

# code.{DOMAIN} {
#     reverse_proxy 127.0.0.1:8443
#     encode gzip
#
#     header {
#         X-Content-Type-Options nosniff
#         X-Frame-Options DENY
#         Referrer-Policy no-referrer
#         Strict-Transport-Security "max-age=31536000; includeSubDomains"
#     }
#
#     log {
#         output file /var/log/caddy/access.log
#         format json
#     }
# }

# === OPTION 2: Without domain (self-signed TLS) ===
# Works with IP access (Tailscale or public IP).
# Accept the self-signed certificate in your browser.

:8080 {
    tls internal
    reverse_proxy 127.0.0.1:8443
    encode gzip
}
